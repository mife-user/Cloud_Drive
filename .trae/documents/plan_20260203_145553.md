## 为现有功能添加Redis缓存操作计划

### 需求分析

用户要求为以下功能添加简单的缓存操作：
- 登录功能
- 注册功能
- 文件上传功能
- 文件查看功能

要求：
- 最小改动
- 不要创建新文件夹
- 简单的缓存操作

### 现有代码结构分析

需要分析的文件：
1. **登录/注册**：`internal/api/handlers/auth.go`、`internal/repo/user_repo.go`
2. **文件上传/查看**：`internal/api/handlers/file.go`、`internal/repo/file_repo.go`
3. **Redis配置**：查看是否已有Redis客户端初始化代码

### 实现方案

#### 1. 检查Redis客户端初始化

首先检查是否已有Redis客户端初始化代码，如果没有，需要在现有配置中添加。

#### 2. 为现有功能添加缓存操作

**登录功能**：
- 缓存用户登录信息
- 缓存键：`user:login:{user_id}`
- 缓存过期：30分钟

**注册功能**：
- 缓存新注册用户信息
- 缓存键：`user:info:{user_id}`
- 缓存过期：1小时

**文件上传功能**：
- 缓存文件元信息
- 缓存键：`file:info:{file_id}`
- 缓存过期：24小时

**文件查看功能**：
- 缓存用户文件列表
- 缓存键：`user:files:{user_id}`
- 缓存过期：10分钟

#### 3. 缓存操作实现

**添加Redis客户端**：
- 在现有配置文件中添加Redis客户端初始化
- 提供简单的Redis操作方法

**修改现有代码**：
- 在`user_repo.go`中添加用户相关的缓存操作
- 在`file_repo.go`中添加文件相关的缓存操作
- 在对应的处理器中添加缓存逻辑

#### 4. 缓存问题处理

- **缓存穿透**：对不存在的用户/文件返回空缓存
- **缓存击穿**：为热点数据设置合理的过期时间
- **缓存雪崩**：设置随机的过期时间偏移

### 具体实现步骤

1. **检查现有Redis配置**：
   - 查看是否已有Redis客户端初始化代码
   - 检查配置文件中的Redis配置

2. **添加Redis客户端工具**：
   - 在现有包中添加Redis操作工具
   - 实现基本的SET、GET、DEL操作

3. **修改用户相关代码**：
   - 修改`user_repo.go`，添加登录和注册的缓存操作
   - 修改`auth.go`，在合适的地方使用缓存

4. **修改文件相关代码**：
   - 修改`file_repo.go`，添加文件上传和查看的缓存操作
   - 修改`file.go`，在合适的地方使用缓存

5. **测试验证**：
   - 验证缓存功能是否正常工作
   - 验证性能是否有提升

### 预期效果

- 登录和注册操作的响应速度提升
- 文件上传和查看操作的响应速度提升
- 系统整体性能改善
- 最小改动，不创建新文件夹